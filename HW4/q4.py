import ElGamal as el

q = 1267563829357910721192610532349240957905695824701
p=154474724567024505552326668667624254530346668891516550168600112845390987269072109602304547293643022259327026218001120791870575104603071951983783939178506546068762532687120696273925570767784225223472959435756693935028851519062765262076784037127804385249530791458749773813851085918817576722179601544649985814629
g=103909996904124632993131371858766165669729607982465958461739488117164223912656915892337662801494883198703452648194921406170215661998544589380930634851778368778250267832833231632014974502522850108470857947473599059781490699897828182798112413851433613933100792383641135076229528835761463113619032894070860192807


(message1, r1, t1) = (b'This is my last message to you',
                           138463133012013282634913641892758158801762848592172407698472135927781184457014021159308423563284158903125454277831143312262376170389801812594838453962655356699229091103625269373494506043148105103719155747470849279981239429070325302155209235130687521331639091969580507394146320441457615197051837733672345300228,
                           106265595589369404671099487302170469354962925840925742209713793365234534431026758828912055935037813410518539768824133366973085636520219854456990152125504837648179032393648480733938344778228349463627323405812952123710763683733706558368525987706254967419548469786325235631013665472833542539156237682564045597699)

(r2, t2) =(138463133012013282634913641892758158801762848592172407698472135927781184457014021159308423563284158903125454277831143312262376170389801812594838453962655356699229091103625269373494506043148105103719155747470849279981239429070325302155209235130687521331639091969580507394146320441457615197051837733672345300228,135563059487582975121566088062898494475175255003560071628710046462630442262636134689239784950989051760061880686659805280094257722717904505303535034697677080651092788318486681967488775262340037022020363930212423666424280959617684767562766700269012486352837430312759302045630777452835207236487134484258912710865)


def intToBytes(pr):
    ln = pr.bit_length()
    bytelen = (ln + 7) // 8
    return pr.to_bytes(bytelen, byteorder="big")

c1 = int.from_bytes(message1, byteorder="big")

# same r values
# same k values
# t1 = (b**k) * m1 modp

m_eks1 = el.modinv(c1, p)
btok = (t1*m_eks1) % p

# t2 = (b**k) * m2 modp
# m2**-1 = t2**-1 * (b**k) modp

t2_eks1 = el.modinv(t2, p)
## m2**-1 = b**k * t**-1 modp
m2_eks1 = (btok * t2_eks1) % p
## find m2 from m2 inverse
m2 = el.modinv(m2_eks1, p)

print(intToBytes(m2))